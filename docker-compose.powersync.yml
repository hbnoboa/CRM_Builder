# PowerSync self-hosted service for CRM Builder mobile app.
# Provides real-time sync between PostgreSQL and Flutter (SQLite).
#
# Usage:
#   docker compose -f docker-compose.powersync.yml up -d
#
# Prerequisites:
#   - PostgreSQL must have wal_level=logical enabled
#   - JWT_SECRET must match the NestJS API JWT secret

services:
  powersync:
    image: journeyapps/powersync-service:latest
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      POWERSYNC_CONFIG: /config/powersync.yaml
      POWERSYNC_REPLICATION_URI: ${DATABASE_URL}
      JWT_SECRET: ${JWT_SECRET}
      # If using MongoDB for storage:
      # POWERSYNC_STORAGE_URI: mongodb://mongo:27017/powersync
    volumes:
      - ./apps/mobile/powersync.yaml:/config/powersync.yaml:ro
    # If running alongside existing docker-compose:
    # network_mode: host
    # OR use the same network:
    # networks:
    #   - crm-network
